/*! granum-lookup.js v1.2.24 */
(()=>{let i=null;var a=e=>document.querySelectorAll(".lookup + div").forEach(e=>e.style.display="");document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll("[data-lookup]").forEach(e=>{e.hidden=!0;const t=document.createElement("div");t.className="pop",t.innerHTML='<input class="lookup" value="'+e.dataset.caption+'" data-cap="'+e.dataset.caption+'"><div class="hide"></div>',e.parentNode.insertBefore(t,e.nextSibling),t.lastChild.style.cursor="pointer"})}),document.addEventListener("input",e=>{const o=e.target.closest(".lookup");o&&(clearTimeout(i),i=setTimeout(e=>{a();const t=o.nextSibling,l=t.parentNode.previousSibling;if(""===o.value)t.style.display="",l.value=o.dataset.cap="";else{const i=l.dataset.lookup.split("#");fetch(i[0].replace(/\{q\}/,encodeURIComponent(o.value))).then(e=>e.ok?e.json():[]).then(e=>t.innerHTML=e.slice(0,5).map((e,t)=>'<div class="pad hover'+(t?"":" bg")+'" data-lookid="'+e[i[1]||"id"]+'"><div>'+e[i[2]||"name"]+"</div>"+(e[i[3]||"info"]?'<div class="small text-n">'+e[i[3]||"info"]+"</div>":"")+"</div>").join("")).then(e=>t.style.display="block")}},500))}),document.addEventListener("click",e=>{const t=e.target.closest("[data-lookid]");if(t){clearTimeout(i);const l=t.parentNode.previousSibling;l.parentNode.previousSibling.value=t.dataset.lookid,l.value=l.dataset.cap=t.firstChild.textContent,t.parentNode.style.display=""}e.target.closest(".lookup, .lookup + div")||a()}),document.addEventListener("keydown",e=>{const t=e.target.closest(".lookup:focus");if(t){const l=t.nextSibling;if("Escape"==e.key)clearTimeout(i),l.style.display="",t.value=t.dataset.cap;else if("ArrowUp"==e.key||"ArrowDown"==e.key)if(l.style.display){let t=l.querySelector("div.bg");t=t?"ArrowUp"==e.key?t.previousSibling||l.lastChild:t.nextSibling||l.firstChild:l.firstChild,l.querySelectorAll("div").forEach(e=>e.classList[e==t?"add":"remove"]("bg"))}else t.dispatchEvent(new Event("input",{bubbles:!0}));else if("Enter"==e.key){let e=l.querySelector("div.bg");e&&e.dispatchEvent(new Event("click",{bubbles:!0}))}}})})();