/*! granum-lookup.js v1.2.25 */
(()=>{let n=null;var a=(e,t)=>e.dispatchEvent(new Event(t,{bubbles:!0})),s=(e,t,l,i)=>{e.value=l,t.value=t.dataset.cap=i,a(e,"input"),a(e,"change")},i=e=>{clearTimeout(n),e.nextSibling.style.display="",e.value=e.dataset.cap};document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll("[data-lookup]").forEach(e=>{e.hidden=!0;var t=e.dataset.caption||"";const l=document.createElement("div");l.className="pop",l.innerHTML='<input class="lookup" name="lookup-'+e.name+'" value="'+t+'" data-cap="'+t+'"'+("get"in e.dataset?" data-get":"")+'><div class="hide"></div>',e.parentNode.insertBefore(l,e.nextSibling),l.lastChild.style.cursor="pointer",a(l.firstChild,"getinput")})}),document.addEventListener("input",e=>{var i=e.target.closest(".lookup");if(i){clearTimeout(n);const a=i.nextSibling,o=a.parentNode.previousSibling;a.style.display="",n=setTimeout(e=>{if(""===i.value)s(o,i,"","");else{const l=o.dataset.lookup.split("#");var t=i.value;fetch(l[0].replace(/\{q\}/,encodeURIComponent(i.value))).then(e=>e.ok?e.json():[]).then(e=>{i.value===t&&(a.innerHTML=e.slice(0,5).map((e,t)=>'<div class="pad hover'+(t?"":" bg")+'" data-lookid="'+e[l[1]||"id"]+'"><div>'+e[l[2]||"name"]+"</div>"+(e[l[3]||"info"]?'<div class="small text-n">'+e[l[3]||"info"]+"</div>":"")+"</div>").join(""),a.style.display="block")})}},300)}}),document.addEventListener("click",e=>{var t=e.target.closest("[data-lookid]");if(t){clearTimeout(n);const l=t.parentNode.previousSibling;s(l.parentNode.previousSibling,l,t.dataset.lookid,t.firstChild.textContent),l.focus()}const l=e.target.closest(".lookup");document.querySelectorAll(".lookup").forEach(e=>e==l?null:i(e))}),document.addEventListener("keydown",e=>{var t=e.target.closest(".lookup:focus");if(t){const l=t.nextSibling;if("Escape"==e.key||"Tab"==e.key)i(t);else if("ArrowUp"==e.key||"ArrowDown"==e.key)if(l.style.display){let t=l.querySelector("div.bg");t=t?"ArrowUp"==e.key?t.previousSibling||l.lastChild:t.nextSibling||l.firstChild:l.firstChild,l.querySelectorAll("div").forEach(e=>e.classList[e==t?"add":"remove"]("bg"))}else a(t,"input");else"Enter"!=e.key||(t=l.querySelector("div.bg"))&&(l.style.display&&e.preventDefault(),a(t,"click"))}})})();