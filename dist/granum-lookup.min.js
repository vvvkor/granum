/*! granum-lookup.js v1.2.25 */
(()=>{let n=null;var o=(e,t)=>e.dispatchEvent(new Event(t,{bubbles:!0})),s=e=>document.querySelectorAll(".lookup + div").forEach(e=>e.style.display=""),d=(e,t,l,i)=>{e.value=l,t.value=t.dataset.cap=i,o(e,"input"),o(e,"change")};document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll("[data-lookup]").forEach(e=>{e.hidden=!0;const t=document.createElement("div");t.className="pop",t.innerHTML='<input class="lookup" value="'+e.dataset.caption+'" data-cap="'+e.dataset.caption+'"><div class="hide"></div>',e.parentNode.insertBefore(t,e.nextSibling),t.lastChild.style.cursor="pointer"})}),document.addEventListener("input",e=>{var i=e.target.closest(".lookup");if(i){clearTimeout(n);const o=i.nextSibling,a=o.parentNode.previousSibling;o.style.display="",n=setTimeout(e=>{if(s(),""===i.value)d(a,i,"","");else{const l=a.dataset.lookup.split("#");var t=i.value;fetch(l[0].replace(/\{q\}/,encodeURIComponent(i.value))).then(e=>e.ok?e.json():[]).then(e=>{i.value===t&&(o.innerHTML=e.slice(0,5).map((e,t)=>'<div class="pad hover'+(t?"":" bg")+'" data-lookid="'+e[l[1]||"id"]+'"><div>'+e[l[2]||"name"]+"</div>"+(e[l[3]||"info"]?'<div class="small text-n">'+e[l[3]||"info"]+"</div>":"")+"</div>").join(""),o.style.display="block")})}},300)}}),document.addEventListener("click",e=>{const t=e.target.closest("[data-lookid]");var l;t&&(clearTimeout(n),l=t.parentNode.previousSibling,d(l.parentNode.previousSibling,l,t.dataset.lookid,t.firstChild.textContent),t.parentNode.style.display=""),e.target.closest(".lookup, .lookup + div")||s()}),document.addEventListener("keydown",e=>{const t=e.target.closest(".lookup:focus");if(t){const i=t.nextSibling;if("Escape"==e.key)clearTimeout(n),i.style.display="",t.value=t.dataset.cap;else if("ArrowUp"==e.key||"ArrowDown"==e.key)if(i.style.display){let t=i.querySelector("div.bg");t=t?"ArrowUp"==e.key?t.previousSibling||i.lastChild:t.nextSibling||i.firstChild:i.firstChild,i.querySelectorAll("div").forEach(e=>e.classList[e==t?"add":"remove"]("bg"))}else o(t,"input");else{var l;"Enter"!=e.key||(l=i.querySelector("div.bg"))&&(i.style.display&&e.preventDefault(),o(l,"click"))}}})})();