/*! granum-lookup.js v1.2.26 */
(()=>{let n=null;var a=(e,t)=>e.dispatchEvent(new Event(t,{bubbles:!0})),d=(e,t,i,l)=>{e.value=i,t.value=t.dataset.cap=l,a(e,"input"),a(e,"change")},l=e=>{clearTimeout(n),e.nextSibling.style.display="",e.value=e.dataset.cap};document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll("[data-lookup]").forEach(e=>{e.hidden=!0;var t=e.dataset.caption||"";const i=document.createElement("div");i.className="pop",i.innerHTML='<input class="lookup" name="lookup-'+e.name+'" value="'+t+'" data-cap="'+t+'" autocomplete="off"'+("get"in e.dataset?" data-get":"")+(e.required?" required":"")+'><div class="hide"></div>',e.parentNode.insertBefore(i,e.nextSibling),a(i.firstChild,"getinput")})}),document.addEventListener("input",e=>{var l=e.target.closest(".lookup");if(l){clearTimeout(n);const a=l.nextSibling,o=a.parentNode.previousSibling;a.style.display="",n=setTimeout(e=>{if(""===l.value)d(o,l,"","");else{const i=o.dataset.lookup.split("#");var t=l.value;fetch(i[0].replace(/\{q\}/,encodeURIComponent(l.value))).then(e=>e.ok?e.json():[]).then(e=>{l.value===t&&(a.innerHTML=e.slice(0,5).map((e,t)=>'<div data-cmd class="pad hover'+(t?"":" bg")+'" data-lookid="'+e[i[1]||"id"]+'"><div>'+e[i[2]||"name"]+"</div>"+(e[i[3]||"info"]?'<div class="small text-n">'+e[i[3]||"info"]+"</div>":"")+"</div>").join(""),a.style.display="block")})}},300)}}),document.addEventListener("click",e=>{var t=e.target.closest("[data-lookid]");if(t){clearTimeout(n);const i=t.parentNode.previousSibling;d(i.parentNode.previousSibling,i,t.dataset.lookid,t.firstChild.textContent),i.focus()}const i=e.target.closest(".lookup");document.querySelectorAll(".lookup").forEach(e=>e==i?null:l(e))}),document.addEventListener("keydown",e=>{var t=e.target.closest(".lookup:focus");if(t){const i=t.nextSibling;if("Escape"==e.key||"Tab"==e.key)l(t);else if("ArrowUp"==e.key||"ArrowDown"==e.key)if(i.style.display){let t=i.querySelector("div.bg");t=t?"ArrowUp"==e.key?t.previousSibling||i.lastChild:t.nextSibling||i.firstChild:i.firstChild,i.querySelectorAll("div").forEach(e=>e.classList[e==t?"add":"remove"]("bg"))}else a(t,"input");else"Enter"!=e.key||(t=i.querySelector("div.bg"))&&(i.style.display&&e.preventDefault(),a(t,"click"))}})})();