/*! granum-lookup.js v1.2.63 */
(()=>{let n=null;var i=(e,t)=>e.dispatchEvent(new Event(t,{bubbles:!0})),s=(e,t,a,o)=>{e.value=a,t.value=t.dataset.cap=o,i(e,"input"),i(t,"input")},o=e=>{clearTimeout(n),d(e).style.display="",e.value=e.dataset.cap};const d=e=>e.previousSibling.lastChild;var r=e=>e.previousSibling.previousSibling;document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll("[data-lookup]").forEach(e=>{e.hidden=!0;var t=e.dataset.caption||"";const a=document.createElement("input");a.type="text",a.className="lookup",a.name="lookup-"+e.name,a.value=a.defaultValue=t,a.autocomplete="off","get"in e.dataset&&(a.dataset.get=""),e.required&&(a.required=!0),e.after(a);const o=document.createElement("div");if(o.className="pop fit",o.innerHTML='<div class="look hide"></div>',e.after(o),e.dataset.goto){const l=document.createElement("span");l.innerHTML=' <a href="#goto" class="icon-right empty" data-goto><b>&rarr;</b></a>',a.after(l)}i(a,"granum-get"),a.dataset.cap=a.value})}),document.addEventListener("input",e=>{var o=e.target.closest(".lookup");if(o){clearTimeout(n);const l=d(o),i=r(o);l.style.display="",n=setTimeout(e=>{if(""===o.value)s(i,o,"","");else{const a=i.dataset.lookup.split("#");var t=o.value;fetch(a[0].replace(/\{q\}/,encodeURIComponent(o.value))).then(e=>e.ok?e.json():[]).then(e=>{o.value===t&&(l.innerHTML=e.slice(0,i.dataset.limit||5).map((e,t)=>'<div data-cmd class="pad hover'+(t?"":" bg")+'" data-id="'+e[a[1]||"id"]+'"><div>'+e[a[2]||"name"]+"</div>"+(e[a[3]||"info"]?'<div class="small text-n">'+e[a[3]||"info"]+"</div>":"")+"</div>").join(""),l.style.display="block")})}},300)}}),document.addEventListener("click",e=>{let t=e.target.closest(".look [data-id]");if(t){clearTimeout(n);const a=t.closest(".pop").nextSibling;s(r(a),a,t.dataset.id,t.firstChild.textContent),a.focus()}const a=e.target.closest(".lookup");document.querySelectorAll(".lookup").forEach(e=>e==a?null:o(e)),t=e.target.closest("a[data-goto]"),t=t&&r(t.parentNode.previousSibling),t&&(e.preventDefault(),t.value&&(location.href=t.dataset.goto.replace(/\{id\}/,encodeURIComponent(t.value))))}),document.addEventListener("keydown",e=>{var t=e.target.closest(".lookup:focus");if(t){const a=d(t);if("Escape"==e.key||"Tab"==e.key)o(t);else if("ArrowUp"==e.key||"ArrowDown"==e.key)if(a.style.display){let t=a.querySelector("div.bg");t=t?"ArrowUp"==e.key?t.previousSibling||a.lastChild:t.nextSibling||a.firstChild:a.firstChild,a.querySelectorAll("div").forEach(e=>e.classList[e==t?"add":"remove"]("bg"))}else i(t,"input");else"Enter"!=e.key||(t=a.querySelector("div.bg"))&&(a.style.display&&e.preventDefault(),i(t,"click"))}})})();